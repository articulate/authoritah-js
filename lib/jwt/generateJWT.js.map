{"version":3,"sources":["../../src/jwt/generateJWT.js"],"names":[],"mappings":";;;;;kBAoBwB,W;;AApBxB;;;;AACA;;;;;;AAEA,IAAM,gBAAgB;AACpB,SAAO;AACL,aAAS,CACP,MADO,EAEP,QAFO,EAGP,QAHO,EAIP,QAJO;AADJ,GADa;AASpB,eAAa;AACX,aAAS,CACP,MADO,EAEP,QAFO;AADE;AATO,CAAtB;;AAiBe,SAAS,WAAT,CAAqB,OAArB,EAA8B;AAAA,MAEzC,MAFyC,GAQrC,OARqC,CAEzC,MAFyC;AAAA,yBAQrC,OARqC,CAGzC,OAHyC;AAAA,MAIvC,MAJuC,oBAIvC,MAJuC;AAAA,MAKvC,GALuC,oBAKvC,GALuC;AAAA,MAMvC,OANuC,oBAMvC,OANuC;;;AAU3C,MAAM,SAAS,OAAO,OAAO,KAAP,CAAa,WAAb,EAA0B,GAA1B,CAAtB;AACA,MAAM,YAAY,UAAU,OAAO,KAAP,CAAa,cAAb,EAA6B,MAA7B,CAA5B;;AAEA,MAAG,OAAH,EAAY;AAAE,WAAO,MAAP,CAAc,eAAd,EAA+B,SAA/B;AAA4C;;AAE1D,MAAM,YAAY,OAAO,MAAP,CAAc,eAAd,EAA+B,KAAK,GAAL,EAA/B,CAAlB;AACA,MAAM,MAAM,OAAO,MAAP,CAAc,SAAd,EAAyB,iBAAO,WAAP,CAAmB,EAAnB,EAAuB,QAAvB,CAAgC,KAAhC,CAAzB,CAAZ;AACA,MAAM,gBAAgB,OAAO,IAAP,CAAY,SAAZ,EAAuB,QAAvB,CAAtB;;AAEA,SAAO,uBAAI,IAAJ,CAAS;AACE,SAAK,MADP;AAEE,YAAQ,aAFV;AAGE,SAAK,SAHP;AAIE,SAAK;AAJP,GAAT,EAKY,aALZ,CAAP;AAMD","file":"generateJWT.js","sourcesContent":["import crypto from 'crypto'\nimport jwt from 'jsonwebtoken'\n\nconst DEFAULT_SCOPE = {\n  rules: {\n    actions: [\n      \"read\",\n      \"update\",\n      \"delete\",\n      \"create\"\n    ]\n  },\n  connections: {\n    actions: [\n      \"read\",\n      \"update\",\n    ]\n  },\n};\n\nexport default function generateJWT(context) {\n  const {\n    config,\n    options: {\n      secret,\n      key,\n      refresh,\n      }\n    } = context;\n\n  const apiKey = key || config.orGet('auth0.key', key);\n  const apiSecret = secret || config.orGet('auth0.secret', secret);\n\n  if(refresh) { config.remove('jwt.createdAt', 'jwt.uid'); }\n\n  const createdAt = config.getset('jwt.createdAt', Date.now());\n  const uid = config.getset('jwt.uid', crypto.randomBytes(16).toString('hex'));\n  const decodedSecret = Buffer.from(apiSecret, 'base64');\n\n  return jwt.sign({\n                    aud: apiKey,\n                    scopes: DEFAULT_SCOPE,\n                    iat: createdAt,\n                    jti: uid,\n                  }, decodedSecret);\n}\n"]}