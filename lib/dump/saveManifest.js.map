{"version":3,"sources":["../../src/dump/saveManifest.js"],"names":[],"mappings":";;;;;kBAgBwB,Y;;AAhBxB;;;;AACA;;;;AACA;;;;;;AAEA,IAAM,YAAY,SAAZ,SAAY,CAAC,KAAD;AAAA,SAAW,gBAAE,GAAF,CAAM,gBAAE,IAAF,CAAO,CAAC,KAAD,CAAP,CAAN,CAAX;AAAA,CAAlB;AACA,IAAM,YAAY,gBAAE,MAAF,CAAS,gBAAE,MAAF,CAAS,MAAT,CAAT,EAChB,gBAAE,MAAF,CAAS,gBAAE,KAAF,CAAQ,KAAK,SAAb,EAAwB,gBAAE,EAA1B,EAA8B,IAA9B,EAAoC,CAApC,CAAT,CADgB,EAEhB,gBAAE,MAAF,CAAS,gBAAE,KAAF,CAAQ,iBAAK,IAAb,EAAmB,gBAAE,EAArB,EAAyB,EAAC,QAAQ,IAAT,EAAzB,CAAT,CAFgB,CAAlB;;AAIA,IAAM,cAAc,gBAAE,IAAF,CAAO,CAAC,OAAD,EAAU,aAAV,EAAyB,SAAzB,CAAP,CAApB;AACA,IAAM,kBAAkB;AACtB,SAAO,UAAU,IAAV,CADe;AAEtB,eAAa,UAAU,IAAV,CAFS;AAGtB,WAAS,UAAU,WAAV;AAHa,CAAxB;;AAMe,SAAS,YAAT,CAAsB,QAAtB,EAAgC;AAC7C,MAAM,SAAS,gBAAE,OAAF,CAAU,aAAG,aAAb,EAA4B,CAAC,QAAD,CAA5B,CAAf;;AAEA,SAAO,UAAS,OAAT,EAAkB;AAAA,QACJ,MADI,GACS,OADT,CACf,OADe,CACJ,MADI;;AAEvB,WAAO,gBAAE,OAAF,CAAU,MAAV,EAAkB,UAAU,MAAV,CAAlB,EAAqC,gBAAE,MAAF,CAAS,eAAT,CAArC,EAAgE,WAAhE,EAA6E,OAA7E,CAAP;AACD,GAHD;AAID","file":"saveManifest.js","sourcesContent":["import yaml from 'js-yaml'\nimport fs from 'fs'\nimport R from 'ramda'\n\nconst dropField = (field) => R.map(R.omit([field]));\nconst formatter = R.ifElse(R.equals('json'),\n  R.always(R.curry(JSON.stringify)(R.__, null, 2)),\n  R.always(R.curry(yaml.dump)(R.__, {noRefs: true})));\n\nconst selectTypes = R.pick(['rules', 'connections', 'clients']);\nconst transformations = {\n  rules: dropField('id'),\n  connections: dropField('id'),\n  clients: dropField('client_id'),\n};\n\nexport default function saveManifest(filename) {\n  const writer = R.partial(fs.writeFileSync, [filename]);\n\n  return function(context) {\n    const { options: { format } } = context;\n    return R.compose(writer, formatter(format), R.evolve(transformations), selectTypes)(context);\n  }\n}\n"]}